{% extends "base.html" %}

{% block title %}Admin Panel - Annotation Tool{% endblock %}

{% block header %}
<div class="header">
    <h1>Admin Panel</h1>
    <div>
        <a href="{{ url_for('dashboard.index') }}">Dashboard</a> |
        <span>{{ current_user.username }}</span> |
        <a href="{{ url_for('auth.logout') }}">Logout</a>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .admin-section {
        margin-bottom: 2rem;
    }

    .admin-section h2 {
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--secondary);
    }

    .user-table {
        width: 100%;
        border-collapse: collapse;
    }

    .user-table th, .user-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--border);
    }

    .user-table th {
        background: var(--primary);
        color: white;
    }

    .user-table tr:hover {
        background: #f0f0f0;
    }

    .role-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .role-admin {
        background: #fee2e2;
        color: #991b1b;
    }

    .role-annotator {
        background: #dbeafe;
        color: #1e40af;
    }

    .role-reviewer {
        background: #d1fae5;
        color: #065f46;
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .btn-small {
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
    }

    .btn-danger {
        background: #dc2626;
    }

    .btn-danger:hover {
        background: #b91c1c;
    }

    .new-user-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-group label {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .form-group input, .form-group select {
        padding: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-section">
    <h2>User Management</h2>

    <div class="card">
        <h3>Add New User</h3>
        <form class="new-user-form" action="{{ url_for('admin.create_user') }}" method="POST"
              hx-post="{{ url_for('admin.create_user') }}"
              hx-swap="none"
              hx-on::after-request="if(event.detail.successful) location.reload()">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="form-group">
                <label for="role">Role</label>
                <select id="role" name="role">
                    <option value="annotator">Annotator</option>
                    <option value="reviewer">Reviewer</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <div class="form-group" style="justify-content: flex-end;">
                <button type="submit" class="btn">Create User</button>
            </div>
        </form>
    </div>

    <div class="card">
        <h3>Existing Users</h3>
        <table class="user-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>
                        <span class="role-badge role-{{ user.role }}">{{ user.role }}</span>
                    </td>
                    <td>{{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}</td>
                    <td>
                        <div class="action-buttons">
                            {% if user.id != current_user.id %}
                            <button class="btn btn-small btn-danger"
                                    hx-delete="{{ url_for('admin.delete_user', user_id=user.id) }}"
                                    hx-confirm="Are you sure you want to delete {{ user.username }}?"
                                    hx-on::after-request="if(event.detail.successful) location.reload()">
                                Delete
                            </button>
                            {% else %}
                            <span style="color: #666; font-size: 0.8rem;">(You)</span>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
